require(['jquery','Netweb_Theme/js/popup','Magento_Customer/js/customer-data'],function($,netwebPopup,customerData){$(document).on('click','.widget_add_to_cart_section',function(){var $this=$(this);var config=Number($this.data('config_id'));var ajaxData={product:config,selected_configurable_option:'',related_product:'',item:config,qty:1,form_key:$("#widget_form_key").val(),};$(".super_attriubte_products").each(function(i,obj){var configID=Number($(obj).data('config_id'));var attrId=$(obj).data('attrid');var value=$(obj).val();if(configID===config){ajaxData['super_attribute['+attrId+']']=value;}});var url=$this.data('post_param_action');widgetsAddToCart.addToCartAjaxPost(url,ajaxData,'add_to_cart',$(this),config);});$(document).on('click','.increase_qty_widgets',function(){var $this=$(this);var configId=Number($this.data('config_id'));var input=$(this).next();var url=$(this).data('update_url');var OldQty=input.val();var itemId=input.attr('id');var newQty=Number(OldQty)+1;if(!newQty||newQty===''){netwebPopup.showErrorPopup('لطفا تعداد را وارد نمایید.');return false;}
newQty=Number(newQty);if(isNaN(newQty)||newQty<0){netwebPopup.showErrorPopup('لطفا مقداد را به صورت عدد وارد نمایید.');return false;}
input.val(newQty);var ajaxData={order_item_id:itemId,qty:newQty};widgetsAddToCart.addToCartAjaxPost(url,ajaxData,'update_item',$this,configId);});$(document).on('click','.decrease_qty_widgets',function(){var $this=$(this);var configId=Number($this.data('config_id'));var input=$(this).prev();var url=$(this).data('update_url');var OldQty=input.val();var itemId=input.attr('id');var newQty=Number(OldQty)-1;if(!newQty||newQty===''){netwebPopup.showErrorPopup('لطفا تعداد را وارد نمایید.');return false;}
newQty=Number(newQty);if(isNaN(newQty)||newQty<0){netwebPopup.showErrorPopup('لطفا مقداد را به صورت عدد وارد نمایید.');return false;}
input.val(newQty);var ajaxData={order_item_id:itemId,qty:newQty};widgetsAddToCart.addToCartAjaxPost(url,ajaxData,'update_item',$this,configId);});$(document).on('click','.delete-icons-widgets',function(){var $this=$(this);var configId=Number($this.data('config_id'));var input=$(this).prev();var url=$(this).data('update_url');var itemId=input.attr('id');var ajaxData={order_item_id:itemId,qty:0};widgetsAddToCart.addToCartAjaxPost(url,ajaxData,'update_item',$this,configId);});$(document).on('keydown','.quote_item_qty_widgets',function(e){if(e.keyCode==13){var input=$(this);var configId=Number(input.data('config_id'));var newQty=input.val();var url=$(this).data('update_url');var orderItemId=input.attr("id");if(!newQty||newQty===''){netwebPopup.showErrorPopup('لطفا تعداد را وارد نمایید.');return false;}
newQty=Number(newQty);if(isNaN(newQty)||newQty<0){netwebPopup.showErrorPopup('لطفا مقداد را به صورت عدد وارد نمایید.');return false;}
var ajaxData={order_item_id:orderItemId,qty:newQty};widgetsAddToCart.addToCartAjaxPost(url,ajaxData,'update_item',input,configId);}});var widgetsAddToCart={addToCartAjaxPost:function(url,ajaxData,mode,elm,configId){$("#netweb_loader").show();$.ajax({url:url,type:'post',data:ajaxData,success:function(res){$("#netweb_loader").hide();var data=res;if(mode==='update_item'){data=JSON.parse(res);if(!data.status&&data.msg&&data.msg!==''){netwebPopup.showErrorPopup(data.msg);}}else if(mode==='add_to_cart'){if(data.messages!=='محصول مورد نظر به سبد خرید افزوده شد.'){netwebPopup.showErrorPopup(data.messages);}else{elm.next().show();elm.remove();}}
var sections=['cart'];customerData.invalidate(sections);customerData.reload(sections,true);widgetsAddToCart.updateInputWidget(configId);return true;},error:function(){$("#netweb_loader").hide();var sections=['cart'];customerData.invalidate(sections);customerData.reload(sections,true);return false;}});},updateInputWidget:function(configId){var sectionId='#widget_elm_for_'+configId;if($(sectionId).length){var url=$("#update_inputs_url_"+configId).val();$("#netweb_loader").show();$.ajax({url:url,type:'post',data:{config_id:configId},success:function(res){$("#netweb_loader").hide();var data=JSON.parse(res);var html=data.html;var content=$($.parseHTML(html)).filter(sectionId);$(sectionId).html(content.html());},error:function(){$("#netweb_loader").hide();}});}}};return widgetsAddToCart;});